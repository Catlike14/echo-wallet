!function(){function n(n,t,e,r,a,c,o){try{var u=n[c](o),i=u.value}catch(n){return void e(n)}u.done?t(i):Promise.resolve(i).then(r,a)}function t(t){return function(){var e=this,r=arguments;return new Promise((function(a,c){var o=t.apply(e,r);function u(t){n(o,a,c,u,i,"next",t)}function i(t){n(o,a,c,u,i,"throw",t)}u(void 0)}))}}function e(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function r(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function a(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function c(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},r=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})))),r.forEach((function(t){a(n,t,e[t])}))}return n}function o(n,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):function(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})),n}function u(n,t){var e,r,a,c,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function u(u){return function(i){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;c&&(c=0,u[0]&&(o=0)),o;)try{if(e=1,r&&(a=2&u[0]?r.return:u[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,u[1])).done)return a;switch(r=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){o.label=u[1];break}if(6===u[0]&&o.label<a[1]){o.label=a[1],a=u;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(u);break}a[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(n,o)}catch(n){u=[6,n],r=0}finally{e=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}}Object.create;Object.create;var i,s=function(){"use strict";function n(t,r){e(this,n),this.name=t,this.handler=r}var t,a,o;return t=n,(a=[{key:"send",value:function(n){window.postMessage(c({action:this.name},n))}},{key:"on",value:function(n){var t=this;return new Promise((function(e,r){window.addEventListener("message",(function(a){if(a.data.action===n)return t.handler&&t.handler(a.data),a.data.error?r(a.data.error):e(a.data)}))}))}}])&&r(t.prototype,a),o&&r(t,o),n}();window.kadena={isKadena:!0,on:(i=t((function(n,t){return u(this,(function(e){switch(e.label){case 0:return[4,new s(n,(function(n){if("res_requestAccount"===n.action&&"kda.dapps"===n.target){var e=window.location.hostname||window.window.location.href;n.account&&n.account.connectedSites&&n.account.connectedSites.includes(e)?t(n):t({})}else t(n)})).on(n)];case 1:return[2,e.sent()]}}))})),function(n,t){return i.apply(this,arguments)}),request:function(){var n=t((function(n){var t,e,r,a,i;return u(this,(function(u){switch(t=window.location.hostname||window.window.location.href,e=d()||"no icon",r=n.method,a=n.networkId,i=o(c({},n),{domain:t}),r){case"kda_connect":return[2,l(a,t,e)];case"kda_disconnect":return[2,v(a,t)];case"kda_checkStatus":return[2,f(i)];case"kda_getNetwork":return[2,p()];case"kda_getChain":return[2,b()];case"kda_getSelectedAccount":return[2,k()];case"kda_requestAccount":return[2,y(a,t)];case"kda_requestSign":return[2,h(o(c({},n.data),{domain:t}))];case"kda_requestQuickSign":return[2,w(o(c({},n.data),{domain:t}))];case"kda_sendKadena":return[2,g(o(c({},n.data),{domain:t}))]}return[2]}))}));return function(t){return n.apply(this,arguments)}}()};var d=function(){for(var n,t=document.getElementsByTagName("link"),e=0;e<t.length;e+=1)"icon"!==t[e].getAttribute("rel")&&"shortcut icon"!==t[e].getAttribute("rel")||(n=t[e].getAttribute("href"));return n?n.includes("http")||n.includes("www")?n:"".concat(window.origin).concat(n):n},l=function(){var n=t((function(n,t,e){var r;return u(this,(function(a){switch(a.label){case 0:return(r=new s("kda_connect")).send({target:"kda.content",action:r.name,data:{networkId:n,domain:t,icon:e}}),[4,r.on("res_checkStatus")];case 1:return[2,a.sent().result]}}))}));return function(t,e,r){return n.apply(this,arguments)}}(),f=function(){var n=t((function(n){var t,e,r;return u(this,(function(a){switch(a.label){case 0:return t=n.networkId,e=n.domain,(r=new s("kda_checkStatus")).send({target:"kda.content",action:r.name,data:{networkId:t,domain:e}}),[4,r.on("res_checkStatus")];case 1:return[2,a.sent().result]}}))}));return function(t){return n.apply(this,arguments)}}(),h=function(){var n=t((function(n){var t;return u(this,(function(e){switch(e.label){case 0:return(t=new s("kda_requestSign")).send({target:"kda.content",action:t.name,data:n}),[4,t.on("res_requestSign")];case 1:return[2,e.sent().result]}}))}));return function(t){return n.apply(this,arguments)}}(),w=function(){var n=t((function(n){var t;return u(this,(function(e){switch(e.label){case 0:return(t=new s("kda_requestQuickSign")).send({target:"kda.content",action:t.name,data:n}),[4,t.on("res_requestQuickSign")];case 1:return[2,e.sent().result]}}))}));return function(t){return n.apply(this,arguments)}}(),p=function(){var n=t((function(){var n;return u(this,(function(t){switch(t.label){case 0:return(n=new s("kda_getNetwork")).send({target:"kda.content",action:n.name,data:{}}),[4,n.on("res_getNetwork")];case 1:return[2,t.sent().network]}}))}));return function(){return n.apply(this,arguments)}}(),b=function(){var n=t((function(){var n;return u(this,(function(t){switch(t.label){case 0:return(n=new s("kda_getChain")).send({target:"kda.content",action:n.name,data:{}}),[4,n.on("res_getChain")];case 1:return[2,t.sent().chainId]}}))}));return function(){return n.apply(this,arguments)}}(),k=function(){var n=t((function(){var n;return u(this,(function(t){switch(t.label){case 0:return(n=new s("kda_getSelectedAccount")).send({target:"kda.content",action:n.name,data:{}}),[4,n.on("res_getSelectedAccount")];case 1:return[2,t.sent().selectedAccount]}}))}));return function(){return n.apply(this,arguments)}}(),g=function(){var n=t((function(n){var t;return u(this,(function(e){switch(e.label){case 0:return(t=new s("kda_sendKadena")).send({target:"kda.content",action:t.name,data:n}),[4,t.on("res_sendKadena")];case 1:return[2,e.sent().data]}}))}));return function(t){return n.apply(this,arguments)}}(),v=function(){var n=t((function(n,t){var e;return u(this,(function(r){switch(r.label){case 0:return(e=new s("kda_disconnect")).send({target:"kda.content",action:e.name,data:{networkId:n,domain:t}}),[4,e.on("res_disconnect")];case 1:return[2,r.sent()]}}))}));return function(t,e){return n.apply(this,arguments)}}(),y=function(){var n=t((function(n,t){var e;return u(this,(function(r){switch(r.label){case 0:return(e=new s("kda_requestAccount")).send({target:"kda.content",action:e.name,data:{networkId:n,domain:t}}),[4,e.on("res_requestAccount")];case 1:return[2,r.sent().result]}}))}));return function(t,e){return n.apply(this,arguments)}}()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU1OLEVBQVNqQyxHQUFHLG1CLE9BQ25DLE8sRUFEaUJVLEVBQUE3QyxPQUFUOEIsTSxHQUVWLEksZ0JBVjBCNEMsRyxnQ0FBcEIsR0FZQXJCLEVBQUEsVyxNQUFtQjFHLEdBQUEsU0FBT3VHLEVBQVdaLEcsSUFDbkM4QixFLGtEQVVDLE9BVkRBLEVBQVcsSUFBSW5ELEVBQVMsbUJBQ3JCb0QsS0FBSyxDQUNaNUcsT0FBUSxjQUNSaUUsT0FBUTBDLEVBQVNqRCxLQUNqQlcsS0FBTSxDQUNKb0IsWUFDQVosWUFJRyxDLEVBQU04QixFQUFTakMsR0FBRyxtQixPQUF6QixPLEVBQU9VLEVBQUE3QyxRLEdBQ1QsSSxnQkFaZ0NrRCxFQUFXWixHLGdDQUFyQyxHQWNBb0IsRUFBQSxXLE1BQXFCL0csR0FBQSxTQUFPdUcsRUFBV1osRyxJQUNyQzhCLEUsa0RBVWEsT0FWYkEsRUFBVyxJQUFJbkQsRUFBUyx1QkFDckJvRCxLQUFLLENBQ1o1RyxPQUFRLGNBQ1JpRSxPQUFRMEMsRUFBU2pELEtBQ2pCVyxLQUFNLENBQ0pvQixZQUNBWixZQUllLEMsRUFBTThCLEVBQVNqQyxHQUFHLHVCLE9BRXJDLE8sRUFGbUJVLEVBQUE3QyxPQUFYc0UsUSxHQUdWLEksZ0JBZGtDcEIsRUFBV1osRyxnQ0FBdkMsRSIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL0Bzd2MvaGVscGVycy9zcmMvX2FzeW5jX3RvX2dlbmVyYXRvci5tanMiLCJub2RlX21vZHVsZXMvQHN3Yy9oZWxwZXJzL3NyYy9fY2xhc3NfY2FsbF9jaGVjay5tanMiLCJub2RlX21vZHVsZXMvQHN3Yy9oZWxwZXJzL3NyYy9fY3JlYXRlX2NsYXNzLm1qcyIsIm5vZGVfbW9kdWxlcy9Ac3djL2hlbHBlcnMvc3JjL19kZWZpbmVfcHJvcGVydHkubWpzIiwibm9kZV9tb2R1bGVzL0Bzd2MvaGVscGVycy9zcmMvX29iamVjdF9zcHJlYWQubWpzIiwibm9kZV9tb2R1bGVzL0Bzd2MvaGVscGVycy9zcmMvX29iamVjdF9zcHJlYWRfcHJvcHMubWpzIiwibm9kZV9tb2R1bGVzL0Bzd2MvaGVscGVycy9ub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwicHVibGljL2FwcC9zY3JpcHQvaW5wYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHtcbiAgdHJ5IHtcbiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7XG4gICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZWplY3QoZXJyb3IpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpbmZvLmRvbmUpIHtcbiAgICByZXNvbHZlKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7XG5cbiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7XG4gICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgXCJuZXh0XCIsIHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikge1xuICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwidGhyb3dcIiwgZXJyKTtcbiAgICAgIH1cblxuICAgICAgX25leHQodW5kZWZpbmVkKTtcbiAgICB9KTtcbiAgfTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtcbiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpO1xuICB9XG59IiwiZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtcbiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7XG4gICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO1xuICAgIGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtcbiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7XG4gIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtcbiAgcmV0dXJuIENvbnN0cnVjdG9yO1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICBpZiAoa2V5IGluIG9iaikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59XG4iLCJpbXBvcnQgZGVmaW5lUHJvcGVydHkgZnJvbSAnLi9fZGVmaW5lX3Byb3BlcnR5Lm1qcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7XG4gIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307XG4gICAgdmFyIG93bktleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpO1xuXG4gICAgaWYgKHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBvd25LZXlzID0gb3duS2V5cy5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzb3VyY2UpLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwgc3ltKS5lbnVtZXJhYmxlO1xuICAgICAgfSkpO1xuICAgIH1cblxuICAgIG93bktleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBkZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHRhcmdldDtcbn0iLCJmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHtcbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpO1xuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpO1xuICAgIGlmIChlbnVtZXJhYmxlT25seSkge1xuICAgICAgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7XG4gICAgICB9KTtcbiAgICB9XG4gICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpO1xuICB9XG4gIHJldHVybiBrZXlzO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkUHJvcHModGFyZ2V0LCBzb3VyY2UpIHtcbiAgc291cmNlID0gc291cmNlICE9IG51bGwgPyBzb3VyY2UgOiB7fVxuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpO1xuICB9IGVsc2Uge1xuICAgIG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFxuICAgICAgICB0YXJnZXQsXG4gICAgICAgIGtleSxcbiAgICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufSIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19lc0RlY29yYXRlKGN0b3IsIGRlc2NyaXB0b3JJbiwgZGVjb3JhdG9ycywgY29udGV4dEluLCBpbml0aWFsaXplcnMsIGV4dHJhSW5pdGlhbGl6ZXJzKSB7XHJcbiAgICBmdW5jdGlvbiBhY2NlcHQoZikgeyBpZiAoZiAhPT0gdm9pZCAwICYmIHR5cGVvZiBmICE9PSBcImZ1bmN0aW9uXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJGdW5jdGlvbiBleHBlY3RlZFwiKTsgcmV0dXJuIGY7IH1cclxuICAgIHZhciBraW5kID0gY29udGV4dEluLmtpbmQsIGtleSA9IGtpbmQgPT09IFwiZ2V0dGVyXCIgPyBcImdldFwiIDoga2luZCA9PT0gXCJzZXR0ZXJcIiA/IFwic2V0XCIgOiBcInZhbHVlXCI7XHJcbiAgICB2YXIgdGFyZ2V0ID0gIWRlc2NyaXB0b3JJbiAmJiBjdG9yID8gY29udGV4dEluW1wic3RhdGljXCJdID8gY3RvciA6IGN0b3IucHJvdG90eXBlIDogbnVsbDtcclxuICAgIHZhciBkZXNjcmlwdG9yID0gZGVzY3JpcHRvckluIHx8ICh0YXJnZXQgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwgY29udGV4dEluLm5hbWUpIDoge30pO1xyXG4gICAgdmFyIF8sIGRvbmUgPSBmYWxzZTtcclxuICAgIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgdmFyIGNvbnRleHQgPSB7fTtcclxuICAgICAgICBmb3IgKHZhciBwIGluIGNvbnRleHRJbikgY29udGV4dFtwXSA9IHAgPT09IFwiYWNjZXNzXCIgPyB7fSA6IGNvbnRleHRJbltwXTtcclxuICAgICAgICBmb3IgKHZhciBwIGluIGNvbnRleHRJbi5hY2Nlc3MpIGNvbnRleHQuYWNjZXNzW3BdID0gY29udGV4dEluLmFjY2Vzc1twXTtcclxuICAgICAgICBjb250ZXh0LmFkZEluaXRpYWxpemVyID0gZnVuY3Rpb24gKGYpIHsgaWYgKGRvbmUpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgYWRkIGluaXRpYWxpemVycyBhZnRlciBkZWNvcmF0aW9uIGhhcyBjb21wbGV0ZWRcIik7IGV4dHJhSW5pdGlhbGl6ZXJzLnB1c2goYWNjZXB0KGYgfHwgbnVsbCkpOyB9O1xyXG4gICAgICAgIHZhciByZXN1bHQgPSAoMCwgZGVjb3JhdG9yc1tpXSkoa2luZCA9PT0gXCJhY2Nlc3NvclwiID8geyBnZXQ6IGRlc2NyaXB0b3IuZ2V0LCBzZXQ6IGRlc2NyaXB0b3Iuc2V0IH0gOiBkZXNjcmlwdG9yW2tleV0sIGNvbnRleHQpO1xyXG4gICAgICAgIGlmIChraW5kID09PSBcImFjY2Vzc29yXCIpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSBjb250aW51ZTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCB0eXBlb2YgcmVzdWx0ICE9PSBcIm9iamVjdFwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IGV4cGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuZ2V0KSkgZGVzY3JpcHRvci5nZXQgPSBfO1xyXG4gICAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuc2V0KSkgZGVzY3JpcHRvci5zZXQgPSBfO1xyXG4gICAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuaW5pdCkpIGluaXRpYWxpemVycy5wdXNoKF8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChfID0gYWNjZXB0KHJlc3VsdCkpIHtcclxuICAgICAgICAgICAgaWYgKGtpbmQgPT09IFwiZmllbGRcIikgaW5pdGlhbGl6ZXJzLnB1c2goXyk7XHJcbiAgICAgICAgICAgIGVsc2UgZGVzY3JpcHRvcltrZXldID0gXztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGFyZ2V0KSBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBjb250ZXh0SW4ubmFtZSwgZGVzY3JpcHRvcik7XHJcbiAgICBkb25lID0gdHJ1ZTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3J1bkluaXRpYWxpemVycyh0aGlzQXJnLCBpbml0aWFsaXplcnMsIHZhbHVlKSB7XHJcbiAgICB2YXIgdXNlVmFsdWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMjtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5pdGlhbGl6ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdmFsdWUgPSB1c2VWYWx1ZSA/IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcsIHZhbHVlKSA6IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVzZVZhbHVlID8gdmFsdWUgOiB2b2lkIDA7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wcm9wS2V5KHgpIHtcclxuICAgIHJldHVybiB0eXBlb2YgeCA9PT0gXCJzeW1ib2xcIiA/IHggOiBcIlwiLmNvbmNhdCh4KTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NldEZ1bmN0aW9uTmFtZShmLCBuYW1lLCBwcmVmaXgpIHtcclxuICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gXCJzeW1ib2xcIikgbmFtZSA9IG5hbWUuZGVzY3JpcHRpb24gPyBcIltcIi5jb25jYXQobmFtZS5kZXNjcmlwdGlvbiwgXCJdXCIpIDogXCJcIjtcclxuICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZiwgXCJuYW1lXCIsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogcHJlZml4ID8gXCJcIi5jb25jYXQocHJlZml4LCBcIiBcIiwgbmFtZSkgOiBuYW1lIH0pO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0sIGspO1xyXG4gICAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbS5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcclxuICAgICAgICBkZXNjID0geyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9O1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCBkZXNjKTtcclxufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICBvW2syXSA9IG1ba107XHJcbn0pO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBvKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSBcImRlZmF1bHRcIiAmJiAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIHApKSBfX2NyZWF0ZUJpbmRpbmcobywgbSwgcCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09IFwibnVtYmVyXCIpIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/IFwiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS5cIiA6IFwiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheXMoKSB7XHJcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcclxuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcclxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcclxuICAgICAgICAgICAgcltrXSA9IGFbal07XHJcbiAgICByZXR1cm4gcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkodG8sIGZyb20sIHBhY2spIHtcclxuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xyXG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xyXG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcclxuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xyXG4gICAgdmFyIGksIHA7XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogZmFsc2UgfSA6IGYgPyBmKHYpIDogdjsgfSA6IGY7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNWYWx1ZXMobykge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBtID0gb1tTeW1ib2wuYXN5bmNJdGVyYXRvcl0sIGk7XHJcbiAgICByZXR1cm4gbSA/IG0uY2FsbChvKSA6IChvID0gdHlwZW9mIF9fdmFsdWVzID09PSBcImZ1bmN0aW9uXCIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaVtuXSA9IG9bbl0gJiYgZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdiA9IG9bbl0odiksIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHYuZG9uZSwgdi52YWx1ZSk7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCBkLCB2KSB7IFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGZ1bmN0aW9uKHYpIHsgcmVzb2x2ZSh7IHZhbHVlOiB2LCBkb25lOiBkIH0pOyB9LCByZWplY3QpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ha2VUZW1wbGF0ZU9iamVjdChjb29rZWQsIHJhdykge1xyXG4gICAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoY29va2VkLCBcInJhd1wiLCB7IHZhbHVlOiByYXcgfSk7IH0gZWxzZSB7IGNvb2tlZC5yYXcgPSByYXc7IH1cclxuICAgIHJldHVybiBjb29rZWQ7XHJcbn07XHJcblxyXG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XHJcbn0pIDogZnVuY3Rpb24obywgdikge1xyXG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XHJcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0RGVmYXVsdChtb2QpIHtcclxuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgZGVmYXVsdDogbW9kIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHJlY2VpdmVyLCBzdGF0ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgZ2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgcmVhZCBwcml2YXRlIG1lbWJlciBmcm9tIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XHJcbiAgICByZXR1cm4ga2luZCA9PT0gXCJtXCIgPyBmIDoga2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIpIDogZiA/IGYudmFsdWUgOiBzdGF0ZS5nZXQocmVjZWl2ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJtXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIG1ldGhvZCBpcyBub3Qgd3JpdGFibGVcIik7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBzZXR0ZXJcIik7XHJcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB3cml0ZSBwcml2YXRlIG1lbWJlciB0byBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIChraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlciwgdmFsdWUpIDogZiA/IGYudmFsdWUgPSB2YWx1ZSA6IHN0YXRlLnNldChyZWNlaXZlciwgdmFsdWUpKSwgdmFsdWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4oc3RhdGUsIHJlY2VpdmVyKSB7XHJcbiAgICBpZiAocmVjZWl2ZXIgPT09IG51bGwgfHwgKHR5cGVvZiByZWNlaXZlciAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgcmVjZWl2ZXIgIT09IFwiZnVuY3Rpb25cIikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgdXNlICdpbicgb3BlcmF0b3Igb24gbm9uLW9iamVjdFwiKTtcclxuICAgIHJldHVybiB0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyID09PSBzdGF0ZSA6IHN0YXRlLmhhcyhyZWNlaXZlcik7XHJcbn1cclxuIiwiY2xhc3MgTGlzdGVuZXIge1xyXG4gIGNvbnN0cnVjdG9yKG5hbWUsIGhhbmRsZXIpIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgc2VuZChwYXlsb2FkKSB7XHJcbiAgICB3aW5kb3cucG9zdE1lc3NhZ2UoeyBhY3Rpb246IHRoaXMubmFtZSwgLi4ucGF5bG9hZCB9KTtcclxuICB9XHJcblxyXG4gIG9uKHJlc3BvbnNlTmFtZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICBpZiAoZXZlbnQuZGF0YS5hY3Rpb24gPT09IHJlc3BvbnNlTmFtZSkge1xyXG4gICAgICAgICAgaWYgKHRoaXMuaGFuZGxlcikge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZXIoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKGV2ZW50LmRhdGEuZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChldmVudC5kYXRhLmVycm9yKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShldmVudC5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogS2FkZW5hIGluc3RhbmNlXHJcbiAqXHJcbiAqIE1ldGhvZHM6XHJcbiAqIG9uOiBwYXJhbXMobmFtZTogU3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pXHJcbiAqXHJcbiAqIHJlcXVlc3Q6IHBhcmFtcyhvcHRpb25zOiBPYmplY3QpXHJcbiAqL1xyXG53aW5kb3cua2FkZW5hID0ge1xyXG4gIGlzS2FkZW5hOiB0cnVlLFxyXG5cclxuICBvbjogYXN5bmMgKG5hbWUsIGNhbGxiYWNrKSA9PiB7XHJcbiAgICBsZXQgbGlzdGVuZXIgPSBuZXcgTGlzdGVuZXIobmFtZSwgKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgIGlmIChyZXNwb25zZS5hY3Rpb24gPT09ICdyZXNfcmVxdWVzdEFjY291bnQnICYmIHJlc3BvbnNlLnRhcmdldCA9PT0gJ2tkYS5kYXBwcycpIHtcclxuICAgICAgICBjb25zdCBkb21haW4gPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgfHwgd2luZG93LndpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5hY2NvdW50ICYmIHJlc3BvbnNlLmFjY291bnQuY29ubmVjdGVkU2l0ZXMgJiYgcmVzcG9uc2UuYWNjb3VudC5jb25uZWN0ZWRTaXRlcy5pbmNsdWRlcyhkb21haW4pKSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNhbGxiYWNrKHt9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBhd2FpdCBsaXN0ZW5lci5vbihuYW1lKTtcclxuICB9LFxyXG5cclxuICByZXF1ZXN0OiBhc3luYyAob3B0aW9ucykgPT4ge1xyXG4gICAgY29uc3QgZG9tYWluID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lIHx8IHdpbmRvdy53aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICAgIGNvbnN0IGljb24gPSBnZXRGYXZpY29uKCkgfHwgJ25vIGljb24nO1xyXG5cclxuICAgIGNvbnN0IHsgbWV0aG9kLCBuZXR3b3JrSWQgfSA9IG9wdGlvbnM7XHJcbiAgICBjb25zdCBpbmZvID0geyAuLi5vcHRpb25zLCBkb21haW4gfTtcclxuXHJcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xyXG4gICAgICBjYXNlICdrZGFfY29ubmVjdCc6XHJcbiAgICAgICAgcmV0dXJuIG9wZW5LYWRlbmFDb25uZWN0KG5ldHdvcmtJZCwgZG9tYWluLCBpY29uKTtcclxuXHJcbiAgICAgIGNhc2UgJ2tkYV9kaXNjb25uZWN0JzpcclxuICAgICAgICByZXR1cm4ga2FkZW5hRGlzY29ubmVjdChuZXR3b3JrSWQsIGRvbWFpbik7XHJcblxyXG4gICAgICBjYXNlICdrZGFfY2hlY2tTdGF0dXMnOlxyXG4gICAgICAgIHJldHVybiBjaGVja1N0YXR1cyhpbmZvKTtcclxuXHJcbiAgICAgIGNhc2UgJ2tkYV9nZXROZXR3b3JrJzpcclxuICAgICAgICByZXR1cm4gZ2V0S2FkZW5hTmV0d29yaygpO1xyXG5cclxuICAgICAgY2FzZSAna2RhX2dldENoYWluJzpcclxuICAgICAgICByZXR1cm4gZ2V0S2FkZW5hQ2hhaW4oKTtcclxuXHJcbiAgICAgIGNhc2UgJ2tkYV9nZXRTZWxlY3RlZEFjY291bnQnOlxyXG4gICAgICAgIHJldHVybiBnZXRTZWxlY3RlZEFjY291bnQoKTtcclxuXHJcbiAgICAgIGNhc2UgJ2tkYV9yZXF1ZXN0QWNjb3VudCc6XHJcbiAgICAgICAgcmV0dXJuIGdldEFjY291bnRTZWxlY3RlZChuZXR3b3JrSWQsIGRvbWFpbik7XHJcblxyXG4gICAgICBjYXNlICdrZGFfcmVxdWVzdFNpZ24nOlxyXG4gICAgICAgIHJldHVybiBrZGFSZXF1ZXN0U2lnbih7IC4uLm9wdGlvbnMuZGF0YSwgZG9tYWluIH0pO1xyXG5cclxuICAgICAgY2FzZSAna2RhX3JlcXVlc3RRdWlja1NpZ24nOlxyXG4gICAgICAgIHJldHVybiBrZGFSZXF1ZXN0UXVpY2tTaWduKHsgLi4ub3B0aW9ucy5kYXRhLCBkb21haW4gfSk7XHJcblxyXG4gICAgICBjYXNlICdrZGFfc2VuZEthZGVuYSc6XHJcbiAgICAgICAgcmV0dXJuIHNlbmRLYWRlbmEoeyAuLi5vcHRpb25zLmRhdGEsIGRvbWFpbiB9KTtcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfSxcclxufTtcclxuXHJcbmNvbnN0IGdldEZhdmljb24gPSAoKSA9PiB7XHJcbiAgbGV0IGZhdmljb247XHJcbiAgY29uc3Qgbm9kZUxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbGluaycpO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZUxpc3QubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgIGlmIChub2RlTGlzdFtpXS5nZXRBdHRyaWJ1dGUoJ3JlbCcpID09PSAnaWNvbicgfHwgbm9kZUxpc3RbaV0uZ2V0QXR0cmlidXRlKCdyZWwnKSA9PT0gJ3Nob3J0Y3V0IGljb24nKSB7XHJcbiAgICAgIGZhdmljb24gPSBub2RlTGlzdFtpXS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcclxuICAgIH1cclxuICB9XHJcbiAgaWYgKGZhdmljb24pIHtcclxuICAgIGlmIChmYXZpY29uLmluY2x1ZGVzKCdodHRwJykgfHwgZmF2aWNvbi5pbmNsdWRlcygnd3d3JykpIHtcclxuICAgICAgcmV0dXJuIGZhdmljb247XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7d2luZG93Lm9yaWdpbn0ke2Zhdmljb259YDtcclxuICB9XHJcbiAgcmV0dXJuIGZhdmljb247XHJcbn07XHJcblxyXG5jb25zdCBvcGVuS2FkZW5hQ29ubmVjdCA9IGFzeW5jIChuZXR3b3JrSWQsIGRvbWFpbiwgaWNvbikgPT4ge1xyXG4gIGNvbnN0IGxpc3RlbmVyID0gbmV3IExpc3RlbmVyKCdrZGFfY29ubmVjdCcpO1xyXG4gIGxpc3RlbmVyLnNlbmQoe1xyXG4gICAgdGFyZ2V0OiAna2RhLmNvbnRlbnQnLFxyXG4gICAgYWN0aW9uOiBsaXN0ZW5lci5uYW1lLFxyXG4gICAgZGF0YToge1xyXG4gICAgICBuZXR3b3JrSWQsXHJcbiAgICAgIGRvbWFpbixcclxuICAgICAgaWNvbixcclxuICAgIH0sXHJcbiAgfSk7XHJcblxyXG4gIGxldCBkYXRhID0gYXdhaXQgbGlzdGVuZXIub24oJ3Jlc19jaGVja1N0YXR1cycpO1xyXG5cclxuICByZXR1cm4gZGF0YS5yZXN1bHQ7XHJcbn07XHJcblxyXG5jb25zdCBjaGVja1N0YXR1cyA9IGFzeW5jIChpbmZvKSA9PiB7XHJcbiAgY29uc3QgeyBuZXR3b3JrSWQsIGRvbWFpbiB9ID0gaW5mbztcclxuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigna2RhX2NoZWNrU3RhdHVzJyk7XHJcbiAgbGlzdGVuZXIuc2VuZCh7XHJcbiAgICB0YXJnZXQ6ICdrZGEuY29udGVudCcsXHJcbiAgICBhY3Rpb246IGxpc3RlbmVyLm5hbWUsXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIG5ldHdvcmtJZCxcclxuICAgICAgZG9tYWluLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgbGV0IGRhdGEgPSBhd2FpdCBsaXN0ZW5lci5vbigncmVzX2NoZWNrU3RhdHVzJyk7XHJcbiAgcmV0dXJuIGRhdGEucmVzdWx0O1xyXG59O1xyXG5cclxuY29uc3Qga2RhUmVxdWVzdFNpZ24gPSBhc3luYyAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGxpc3RlbmVyID0gbmV3IExpc3RlbmVyKCdrZGFfcmVxdWVzdFNpZ24nKTtcclxuICBsaXN0ZW5lci5zZW5kKHtcclxuICAgIHRhcmdldDogJ2tkYS5jb250ZW50JyxcclxuICAgIGFjdGlvbjogbGlzdGVuZXIubmFtZSxcclxuICAgIGRhdGEsXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbGlzdGVuZXIub24oJ3Jlc19yZXF1ZXN0U2lnbicpO1xyXG4gIHJldHVybiByZXNwb25zZS5yZXN1bHQ7XHJcbn07XHJcblxyXG5jb25zdCBrZGFSZXF1ZXN0UXVpY2tTaWduID0gYXN5bmMgKGRhdGEpID0+IHtcclxuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigna2RhX3JlcXVlc3RRdWlja1NpZ24nKTtcclxuICBsaXN0ZW5lci5zZW5kKHtcclxuICAgIHRhcmdldDogJ2tkYS5jb250ZW50JyxcclxuICAgIGFjdGlvbjogbGlzdGVuZXIubmFtZSxcclxuICAgIGRhdGEsXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbGlzdGVuZXIub24oJ3Jlc19yZXF1ZXN0UXVpY2tTaWduJyk7XHJcbiAgcmV0dXJuIHJlc3BvbnNlLnJlc3VsdDtcclxufTtcclxuXHJcbmNvbnN0IGdldEthZGVuYU5ldHdvcmsgPSBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgbGlzdGVuZXIgPSBuZXcgTGlzdGVuZXIoJ2tkYV9nZXROZXR3b3JrJyk7XHJcbiAgbGlzdGVuZXIuc2VuZCh7XHJcbiAgICB0YXJnZXQ6ICdrZGEuY29udGVudCcsXHJcbiAgICBhY3Rpb246IGxpc3RlbmVyLm5hbWUsXHJcbiAgICBkYXRhOiB7fSxcclxuICB9KTtcclxuXHJcbiAgbGV0IGRhdGEgPSBhd2FpdCBsaXN0ZW5lci5vbigncmVzX2dldE5ldHdvcmsnKTtcclxuXHJcbiAgcmV0dXJuIGRhdGEubmV0d29yaztcclxufTtcclxuXHJcbmNvbnN0IGdldEthZGVuYUNoYWluID0gYXN5bmMgKCkgPT4ge1xyXG4gIGNvbnN0IGxpc3RlbmVyID0gbmV3IExpc3RlbmVyKCdrZGFfZ2V0Q2hhaW4nKTtcclxuICBsaXN0ZW5lci5zZW5kKHtcclxuICAgIHRhcmdldDogJ2tkYS5jb250ZW50JyxcclxuICAgIGFjdGlvbjogbGlzdGVuZXIubmFtZSxcclxuICAgIGRhdGE6IHt9LFxyXG4gIH0pO1xyXG5cclxuICBsZXQgZGF0YSA9IGF3YWl0IGxpc3RlbmVyLm9uKCdyZXNfZ2V0Q2hhaW4nKTtcclxuXHJcbiAgcmV0dXJuIGRhdGEuY2hhaW5JZDtcclxufTtcclxuXHJcbmNvbnN0IGdldFNlbGVjdGVkQWNjb3VudCA9IGFzeW5jICgpID0+IHtcclxuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigna2RhX2dldFNlbGVjdGVkQWNjb3VudCcpO1xyXG4gIGxpc3RlbmVyLnNlbmQoe1xyXG4gICAgdGFyZ2V0OiAna2RhLmNvbnRlbnQnLFxyXG4gICAgYWN0aW9uOiBsaXN0ZW5lci5uYW1lLFxyXG4gICAgZGF0YToge30sXHJcbiAgfSk7XHJcblxyXG4gIGxldCBkYXRhID0gYXdhaXQgbGlzdGVuZXIub24oJ3Jlc19nZXRTZWxlY3RlZEFjY291bnQnKTtcclxuXHJcbiAgcmV0dXJuIGRhdGEuc2VsZWN0ZWRBY2NvdW50O1xyXG59O1xyXG5cclxuY29uc3Qgc2VuZEthZGVuYSA9IGFzeW5jIChwYXJhbXMpID0+IHtcclxuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigna2RhX3NlbmRLYWRlbmEnKTtcclxuICBsaXN0ZW5lci5zZW5kKHtcclxuICAgIHRhcmdldDogJ2tkYS5jb250ZW50JyxcclxuICAgIGFjdGlvbjogbGlzdGVuZXIubmFtZSxcclxuICAgIGRhdGE6IHBhcmFtcyxcclxuICB9KTtcclxuXHJcbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBsaXN0ZW5lci5vbigncmVzX3NlbmRLYWRlbmEnKTtcclxuICByZXR1cm4gZGF0YTtcclxufTtcclxuXHJcbmNvbnN0IGthZGVuYURpc2Nvbm5lY3QgPSBhc3luYyAobmV0d29ya0lkLCBkb21haW4pID0+IHtcclxuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigna2RhX2Rpc2Nvbm5lY3QnKTtcclxuICBsaXN0ZW5lci5zZW5kKHtcclxuICAgIHRhcmdldDogJ2tkYS5jb250ZW50JyxcclxuICAgIGFjdGlvbjogbGlzdGVuZXIubmFtZSxcclxuICAgIGRhdGE6IHtcclxuICAgICAgbmV0d29ya0lkLFxyXG4gICAgICBkb21haW4sXHJcbiAgICB9LFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gYXdhaXQgbGlzdGVuZXIub24oJ3Jlc19kaXNjb25uZWN0Jyk7XHJcbn07XHJcblxyXG5jb25zdCBnZXRBY2NvdW50U2VsZWN0ZWQgPSBhc3luYyAobmV0d29ya0lkLCBkb21haW4pID0+IHtcclxuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lcigna2RhX3JlcXVlc3RBY2NvdW50Jyk7XHJcbiAgbGlzdGVuZXIuc2VuZCh7XHJcbiAgICB0YXJnZXQ6ICdrZGEuY29udGVudCcsXHJcbiAgICBhY3Rpb246IGxpc3RlbmVyLm5hbWUsXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIG5ldHdvcmtJZCxcclxuICAgICAgZG9tYWluLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgY29uc3QgeyByZXN1bHQgfSA9IGF3YWl0IGxpc3RlbmVyLm9uKCdyZXNfcmVxdWVzdEFjY291bnQnKTtcclxuXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufTtcclxuIl0sIm5hbWVzIjpbIiRjYWViYjFiYTA5OWE0NGFmJHZhciRhc3luY0dlbmVyYXRvclN0ZXAiLCJnZW4iLCJyZXNvbHZlIiwicmVqZWN0IiwiX25leHQiLCJfdGhyb3ciLCJrZXkiLCJhcmciLCJpbmZvIiwidmFsdWUiLCJlcnJvciIsImRvbmUiLCJQcm9taXNlIiwidGhlbiIsIiRjYWViYjFiYTA5OWE0NGFmJGV4cG9ydCQyZTJiY2Q4NzM5YWUwMzkiLCJmbiIsInNlbGYiLCJ0aGlzIiwiYXJncyIsImFyZ3VtZW50cyIsImFwcGx5IiwiZXJyIiwidW5kZWZpbmVkIiwiJGQzYmUzZGU1ZGQzOTk5MDkkZXhwb3J0JDJlMmJjZDg3MzlhZTAzOSIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCIkNjQ2YjZlMDRlOWRkZWQxMyR2YXIkX2RlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCIkMjhhYjc0ZjQzYWM1NWU4NCRleHBvcnQkMmUyYmNkODczOWFlMDM5Iiwib2JqIiwiJGYwY2M2MGQ0Mjc0YzRmZGYkZXhwb3J0JDJlMmJjZDg3MzlhZTAzOSIsInNvdXJjZSIsIm93bktleXMiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwiY29uY2F0IiwiZmlsdGVyIiwic3ltIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZm9yRWFjaCIsIiRlMmVkMWI2ZDdiOWVkOGE0JGV4cG9ydCQyZTJiY2Q4NzM5YWUwMzkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsIm9iamVjdCIsImVudW1lcmFibGVPbmx5Iiwic3ltYm9scyIsInB1c2giLCIkZTJlZDFiNmQ3YjllZDhhNCR2YXIkb3duS2V5cyIsIiQ1YWM3NTgxMGNmMDIzMDE1JGV4cG9ydCQ2N2ViZWY2MGU2ZjI4YTYiLCJ0aGlzQXJnIiwiYm9keSIsImYiLCJ5IiwidCIsImciLCJfIiwibGFiZWwiLCJzZW50IiwidHJ5cyIsIm9wcyIsIm5leHQiLCJ2ZXJiIiwidGhyb3ciLCJyZXR1cm4iLCJTeW1ib2wiLCJpdGVyYXRvciIsIm4iLCJ2Iiwib3AiLCJjYWxsIiwicG9wIiwiZSIsInN0ZXAiLCJjcmVhdGUiLCIkMDgwYTc1ZmI4OGM0YTA1ZiR2YXIkTGlzdGVuZXIiLCJMaXN0ZW5lciIsIm5hbWUiLCJoYW5kbGVyIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicGF5bG9hZCIsIndpbmRvdyIsInBvc3RNZXNzYWdlIiwiYWN0aW9uIiwicmVzcG9uc2VOYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZGF0YSIsIl90aGlzIiwicHJvdG90eXBlIiwia2FkZW5hIiwiaXNLYWRlbmEiLCJvbiIsImNhbGxiYWNrIiwicmVzcG9uc2UiLCJkb21haW4iLCJsb2NhdGlvbiIsImhvc3RuYW1lIiwiaHJlZiIsImFjY291bnQiLCJjb25uZWN0ZWRTaXRlcyIsImluY2x1ZGVzIiwiX3N0YXRlIiwicmVxdWVzdCIsIm9wdGlvbnMiLCJpY29uIiwibWV0aG9kIiwibmV0d29ya0lkIiwiJDA4MGE3NWZiODhjNGEwNWYkdmFyJGdldEZhdmljb24iLCIkMDgwYTc1ZmI4OGM0YTA1ZiR2YXIkb3BlbkthZGVuYUNvbm5lY3QiLCIkMDgwYTc1ZmI4OGM0YTA1ZiR2YXIka2FkZW5hRGlzY29ubmVjdCIsIiQwODBhNzVmYjg4YzRhMDVmJHZhciRjaGVja1N0YXR1cyIsIiQwODBhNzVmYjg4YzRhMDVmJHZhciRnZXRLYWRlbmFOZXR3b3JrIiwiJDA4MGE3NWZiODhjNGEwNWYkdmFyJGdldEthZGVuYUNoYWluIiwiJDA4MGE3NWZiODhjNGEwNWYkdmFyJGdldFNlbGVjdGVkQWNjb3VudCIsIiQwODBhNzVmYjg4YzRhMDVmJHZhciRnZXRBY2NvdW50U2VsZWN0ZWQiLCIkMDgwYTc1ZmI4OGM0YTA1ZiR2YXIka2RhUmVxdWVzdFNpZ24iLCIkMDgwYTc1ZmI4OGM0YTA1ZiR2YXIka2RhUmVxdWVzdFF1aWNrU2lnbiIsIiQwODBhNzVmYjg4YzRhMDVmJHZhciRzZW5kS2FkZW5hIiwiZmF2aWNvbiIsIm5vZGVMaXN0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldEF0dHJpYnV0ZSIsIm9yaWdpbiIsImxpc3RlbmVyIiwic2VuZCIsInJlc3VsdCIsIm5ldHdvcmsiLCJjaGFpbklkIiwic2VsZWN0ZWRBY2NvdW50IiwicGFyYW1zIl0sInZlcnNpb24iOjMsImZpbGUiOiJpbnBhZ2UuanMubWFwIn0=
